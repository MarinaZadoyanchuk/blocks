import $editor from 'weblium/editor'

const setStyleProperties = properties => node =>
  properties.map(([propertyName, value]) => node.style.setProperty(propertyName, value))

const resetStyleProperties = properties => node =>
  properties.map(propertyName => node.style.removeProperty(propertyName))

class Block extends React.Component {
  static propTypes = {
    components: PropTypes.object.isRequired,
    style: PropTypes.object.isRequired,
  }

  state = {
    opened: false,
  }

  componentDidMount() {
    const script = document.createElement('script')
    script.type = 'text/javascript'
    script.async = true
    script.innerHTML = `
    <!-- Google Analytics -->
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-‎110145245-1', 'auto');
    ga('send', 'pageview');
    <!-- End Google Analytics -->

    if(window.location.pathname == '/') {
      // тут мы типа достаём все кнопки и якоря
      const forms = document.getElementsByTagName('form')
      const anchors = document.getElementsByTagName('a')
      
      // а тут из этих кнопок достаём нужную
      const callMeForm = forms && forms[0]
      const sendRequestForm = forms && forms[1]
      // а ниже из якорей
      const leaveRequest = anchors && Array.from(anchors).filter(button => (button.innerText).startsWith('ОСТАВИТЬ ЗАЯВКУ'))[0]
      
      
      // навешиваем функционал на клик
      callMeForm.onsubmit = () => ga('send', 'event', 'Button', 'click', 'Callback_header');
      sendRequestForm.onsubmit = () => ga('send', 'event', 'Button', 'click', 'send_request');
      leaveRequest.onclick = () => ga('send', 'event', 'Button', 'click', 'request_advantages')

      if(window.location.pathname == '/services') {
        const forms = document.getElementsByTagName('form')
        const callMeFormServices = forms && forms[0]
        callMeFormServices.onsubmit = () => ga('send', 'event', 'Button','click', 'Callback_services');
      }
    }`
    this.instance.appendChild(script)
  }

  setStylesForBody = () => {
    const {opened} = this.state
    const nodes = [document.getElementsByTagName('html')[0], document.body]

    if (opened) {
      nodes.forEach(setStyleProperties([['overflow-y', 'hidden'], ['height', '100%']]))
    } else {
      nodes.forEach(resetStyleProperties(['overflow-y', 'height']))
    }
  }

  toggleOpened = () => this.setState({opened: !this.state.opened}, this.setStylesForBody)

  render() {
    const {components: {Text, Menu}, style: css} = this.props
    const {opened} = this.state

    return (
      <header
        className={classNames(css.header, opened && css['header--nav-open'])}
        data-header="target"
        ref={(ref) => {
          this.instance = ref
        }}
      >
        <div className={css.header__inner}>
          <a className={css.logo} href="/">
            <svg width="207" height="51" xmlns="http://www.w3.org/2000/svg"><g fill="none" fillRule="evenodd"><path d="M7.944 17H5.256v-6.768L.096.56h3l3.48 7.056L10.08.56h2.976l-5.112 9.672V17zm13.104-2.064c1.536 0 2.572-.464 3.108-1.392.536-.928.804-2.484.804-4.668s-.276-3.772-.828-4.764c-.552-.992-1.58-1.488-3.084-1.488s-2.536.496-3.096 1.488-.84 2.572-.84 4.74.272 3.724.816 4.668c.544.944 1.584 1.416 3.12 1.416zm0 2.328c-2.48 0-4.216-.676-5.208-2.028-.992-1.352-1.488-3.476-1.488-6.372s.5-5.048 1.5-6.456C16.852 1 18.584.296 21.048.296c2.464 0 4.192.7 5.184 2.1.992 1.4 1.488 3.556 1.488 6.468s-.492 5.04-1.476 6.384c-.984 1.344-2.716 2.016-5.196 2.016zm12.312-5.52c0 2.128 1.12 3.192 3.36 3.192 2.24 0 3.36-1.064 3.36-3.192V.56h2.688v11.136c0 1.936-.508 3.348-1.524 4.236-1.016.888-2.528 1.332-4.536 1.332-2.008 0-3.516-.444-4.524-1.332-1.008-.888-1.512-2.3-1.512-4.236V.56h2.688v11.184zm15.72-.6V17h-2.664V.56h6.24c3.712 0 5.568 1.744 5.568 5.232 0 2.336-.896 3.92-2.688 4.752L58.248 17H55.32l-2.376-5.856H49.08zm6.408-5.328c0-1.968-.944-2.952-2.832-2.952H49.08V8.84h3.624c.96 0 1.664-.276 2.112-.828.448-.552.672-1.284.672-2.196zm5.328 5.904V9.344h7.176v2.376h-7.176zm63.72 5.28v-3.456h2.808V17h-2.808zm11.856 0h-5.688V.56h5.688c2.528 0 4.256.64 5.184 1.92.928 1.28 1.392 3.288 1.392 6.024 0 1.392-.092 2.572-.276 3.54a8.075 8.075 0 0 1-.972 2.628c-.912 1.552-2.688 2.328-5.328 2.328zm3.816-8.496c0-1.984-.248-3.416-.744-4.296-.496-.88-1.52-1.32-3.072-1.32h-3.024v11.76h3.024c1.584 0 2.64-.584 3.168-1.752a7.062 7.062 0 0 0 .516-1.896c.088-.672.132-1.504.132-2.496zm5.88 8.496V.56h10.368v2.328h-7.704v4.656h6.264v2.304h-6.264v4.8h7.704V17h-10.368zm18.096-14.376c-2.032 0-3.048.712-3.048 2.136 0 .736.24 1.26.72 1.572.48.312 1.54.696 3.18 1.152 1.64.456 2.796 1 3.468 1.632.672.632 1.008 1.628 1.008 2.988 0 1.728-.492 3.02-1.476 3.876-.984.856-2.324 1.284-4.02 1.284-1.36 0-2.864-.16-4.512-.48l-.864-.168.264-2.136c2.16.288 3.808.432 4.944.432 1.984 0 2.976-.88 2.976-2.64 0-.688-.224-1.196-.672-1.524-.448-.328-1.456-.688-3.024-1.08-1.568-.392-2.736-.932-3.504-1.62-.768-.688-1.152-1.776-1.152-3.264 0-1.488.484-2.612 1.452-3.372.968-.76 2.308-1.14 4.02-1.14 1.232 0 2.688.144 4.368.432l.84.144-.216 2.16c-2.24-.256-3.824-.384-4.752-.384zM172.392 17V.56h2.664V17h-2.664zm13.152-6.288V8.36h4.68v8.352c-.432.112-1.308.232-2.628.36-1.32.128-2.276.192-2.868.192-2.496 0-4.216-.688-5.16-2.064-.944-1.376-1.416-3.532-1.416-6.468s.484-5.076 1.452-6.42c.968-1.344 2.644-2.016 5.028-2.016 1.408 0 2.992.16 4.752.48l.84.168-.096 2.112c-1.936-.256-3.672-.384-5.208-.384s-2.588.432-3.156 1.296c-.568.864-.852 2.464-.852 4.8s.268 3.948.804 4.836c.536.888 1.62 1.332 3.252 1.332 1.168 0 2.04-.072 2.616-.216v-4.008h-2.04zM193.56 17V.56h4.656l4.992 14.088h.36V.56h2.664V17h-4.56L196.56 2.888h-.336V17h-2.664z" fill="#FFF" /><path d="M71.352.56h6.24c1.68 0 2.936.34 3.768 1.02.832.68 1.248 1.764 1.248 3.252 0 .976-.156 1.744-.468 2.304-.312.56-.804 1.024-1.476 1.392 1.568.608 2.352 1.88 2.352 3.816 0 3.104-1.744 4.656-5.232 4.656h-6.432V.56zm6.24 9.264h-3.576v4.872h3.624c.88 0 1.54-.184 1.98-.552.44-.368.66-1 .66-1.896 0-.896-.256-1.524-.768-1.884-.512-.36-1.152-.54-1.92-.54zm-.144-6.96h-3.432v4.704h3.528c1.568 0 2.352-.808 2.352-2.424 0-1.52-.816-2.28-2.448-2.28zM86.04 17V.56h10.368v2.328h-7.704v4.656h6.264v2.304h-6.264v4.8h7.704V17zM104.136 2.624c-2.032 0-3.048.712-3.048 2.136 0 .736.24 1.26.72 1.572.48.312 1.54.696 3.18 1.152 1.64.456 2.796 1 3.468 1.632.672.632 1.008 1.628 1.008 2.988 0 1.728-.492 3.02-1.476 3.876-.984.856-2.324 1.284-4.02 1.284-1.36 0-2.864-.16-4.512-.48l-.864-.168.264-2.136c2.16.288 3.808.432 4.944.432 1.984 0 2.976-.88 2.976-2.64 0-.688-.224-1.196-.672-1.524-.448-.328-1.456-.688-3.024-1.08-1.568-.392-2.736-.932-3.504-1.62-.768-.688-1.152-1.776-1.152-3.264 0-1.488.484-2.612 1.452-3.372.968-.76 2.308-1.14 4.02-1.14 1.232 0 2.688.144 4.368.432l.84.144-.216 2.16c-2.24-.256-3.824-.384-4.752-.384zM110.76 2.936V.56h12v2.376h-4.632V17h-2.688V2.936z" fill="#C2185B" /><path d="M29.539 47H28.51v-6.614c0-.55.017-1.07.051-1.562a6.713 6.713 0 0 1-.298.28c-.11.097-.614.51-1.511 1.237l-.559-.723 2.457-1.898h.889V47zm6.601-9.414c.846 0 1.517.197 2.012.59.495.394.743.938.743 1.632 0 .457-.142.874-.425 1.25-.284.377-.737.72-1.359 1.029.754.36 1.289.737 1.606 1.133.318.396.476.854.476 1.374 0 .77-.268 1.385-.806 1.844-.537.46-1.274.689-2.209.689-.99 0-1.752-.217-2.285-.65-.533-.434-.8-1.05-.8-1.845 0-1.062.648-1.89 1.943-2.482-.584-.33-1.003-.686-1.257-1.07a2.275 2.275 0 0 1-.381-1.285c0-.672.249-1.209.746-1.609.497-.4 1.162-.6 1.996-.6zm-2.006 7.072c0 .508.177.903.53 1.187.354.283.85.425 1.489.425.63 0 1.121-.148 1.472-.444.352-.297.527-.703.527-1.22 0-.41-.165-.775-.495-1.094-.33-.32-.905-.63-1.726-.93-.63.27-1.088.57-1.371.898a1.74 1.74 0 0 0-.426 1.178zm1.993-6.215c-.529 0-.943.127-1.244.381-.3.254-.45.593-.45 1.016 0 .39.124.723.374 1.003.25.28.711.558 1.384.838.605-.254 1.034-.527 1.285-.82.252-.291.378-.632.378-1.021 0-.428-.153-.767-.46-1.019-.307-.252-.73-.378-1.267-.378zM49.547 47H48.48v-6.056h-2.088c-.115 1.507-.273 2.702-.476 3.587-.204.884-.467 1.532-.79 1.942-.324.41-.736.616-1.235.616-.229 0-.41-.026-.546-.076v-.781c.093.025.199.038.317.038.487 0 .874-.514 1.162-1.542.287-1.029.505-2.59.654-4.685h4.068V47zm5.173.127c-1.029 0-1.84-.313-2.435-.94-.594-.626-.891-1.495-.891-2.608 0-1.122.276-2.013.828-2.673.552-.66 1.294-.99 2.225-.99.872 0 1.561.287 2.07.86.507.574.76 1.33.76 2.27v.666h-4.792c.022.817.228 1.437.62 1.86.39.423.942.635 1.653.635.749 0 1.49-.157 2.221-.47v.94c-.372.16-.724.275-1.056.345a5.94 5.94 0 0 1-1.203.105zm-.286-6.329c-.559 0-1.004.182-1.336.546-.332.364-.528.868-.587 1.511h3.637c0-.664-.148-1.173-.444-1.527-.297-.353-.72-.53-1.27-.53zm9.331.146h-2.26V47h-1.053v-6.056h-2.235v-.901h5.548v.901zm5.808-.901v2.914h3.898v-2.914h1.053V47h-1.053v-3.136h-3.898V47H68.52v-6.957h1.053zM81.037 47l-.21-.99h-.05c-.347.436-.693.73-1.038.885-.345.155-.775.232-1.292.232-.69 0-1.23-.178-1.622-.533-.391-.356-.587-.861-.587-1.517 0-1.405 1.124-2.142 3.37-2.21l1.182-.037v-.432c0-.546-.118-.949-.353-1.21-.235-.26-.61-.39-1.126-.39-.58 0-1.236.178-1.968.534l-.324-.807a4.951 4.951 0 0 1 1.127-.438 4.88 4.88 0 0 1 1.228-.158c.83 0 1.444.184 1.844.552.4.368.6.958.6 1.771V47h-.78zm-2.38-.743c.656 0 1.17-.18 1.545-.54.375-.359.562-.863.562-1.51v-.628l-1.054.044c-.837.03-1.442.16-1.812.39-.37.231-.555.59-.555 1.076 0 .381.115.671.346.87.23.199.553.298.968.298zm11.946.87a3.01 3.01 0 0 1-1.24-.25 2.334 2.334 0 0 1-.944-.772h-.076c.051.406.076.791.076 1.155v2.863h-1.053v-10.08h.857l.146.952h.05c.271-.38.587-.656.946-.825.36-.17.773-.254 1.238-.254.923 0 1.635.315 2.136.946.501.63.752 1.515.752 2.653 0 1.143-.255 2.03-.765 2.663s-1.217.949-2.123.949zm-.152-6.316c-.711 0-1.225.197-1.543.59-.317.394-.48 1.02-.489 1.88v.234c0 .978.163 1.677.49 2.098.325.421.848.632 1.567.632.601 0 1.072-.244 1.412-.73.341-.487.511-1.158.511-2.013 0-.867-.17-1.533-.51-1.996-.341-.463-.82-.695-1.438-.695zm5.935 2.107h1.898c.884 0 1.539.164 1.964.492.426.328.638.818.638 1.47 0 .698-.225 1.226-.676 1.584-.45.357-1.114.536-1.99.536h-2.888v-6.957h1.054v2.875zM103.108 47h-1.054v-6.957h1.054V47zm-6.722-3.174v2.292h1.783c1.118 0 1.676-.392 1.676-1.175 0-.389-.129-.672-.387-.85-.258-.178-.698-.267-1.32-.267h-1.752zm10.01-3.783v2.914h3.897v-2.914h1.054V47h-1.054v-3.136h-3.897V47h-1.054v-6.957h1.054zm11.242 0h1.155l-3.002 3.358L119.04 47h-1.232l-3.174-3.523V47h-1.053v-6.957h1.053v3.383l3.003-3.383zm5.63 7.084c-1.028 0-1.84-.313-2.434-.94-.595-.626-.892-1.495-.892-2.608 0-1.122.276-2.013.828-2.673.553-.66 1.294-.99 2.225-.99.872 0 1.562.287 2.07.86.507.574.761 1.33.761 2.27v.666h-4.792c.02.817.227 1.437.619 1.86.391.423.942.635 1.653.635.75 0 1.49-.157 2.222-.47v.94c-.373.16-.725.275-1.057.345a5.94 5.94 0 0 1-1.203.105zm-.286-6.329c-.558 0-1.004.182-1.336.546-.332.364-.528.868-.587 1.511h3.637c0-.664-.148-1.173-.444-1.527-.296-.353-.72-.53-1.27-.53zm14.06 8.608h-1.021V47h-4.863v2.406h-1.015v-3.314h.545c.568-.77 1.012-1.673 1.333-2.71.322-1.037.49-2.15.502-3.339h3.523v6.05h.996v3.313zm-2.012-3.314v-5.217h-1.561c-.055.939-.236 1.89-.543 2.853-.307.963-.689 1.75-1.146 2.364h3.25zm4.393-6.049v4.412l-.045 1.155-.019.362 3.765-5.929h1.314V47h-.984v-4.253l.019-.838.031-.825L139.747 47h-1.314v-6.957h.99zm8.576 2.888c1.316 0 1.974-.364 1.974-1.092 0-.685-.534-1.028-1.6-1.028-.326 0-.622.03-.889.089-.266.06-.615.178-1.047.355l-.375-.857a5.704 5.704 0 0 1 2.355-.482c.8 0 1.43.164 1.892.492.461.328.692.775.692 1.342 0 .78-.434 1.29-1.301 1.53v.051c.533.157.922.38 1.168.67.245.29.368.652.368 1.088 0 .644-.26 1.144-.778 1.502-.518.357-1.234.536-2.148.536-1.003 0-1.778-.15-2.324-.45v-.966a5.474 5.474 0 0 0 2.349.546c.61 0 1.07-.104 1.38-.314.312-.21.467-.51.467-.904 0-.809-.658-1.213-1.974-1.213h-.965v-.895H148zM157.228 47l-.21-.99h-.05c-.347.436-.693.73-1.038.885-.345.155-.776.232-1.292.232-.69 0-1.23-.178-1.622-.533-.391-.356-.587-.861-.587-1.517 0-1.405 1.124-2.142 3.37-2.21l1.181-.037v-.432c0-.546-.117-.949-.352-1.21-.235-.26-.61-.39-1.127-.39-.58 0-1.235.178-1.967.534l-.324-.807a4.951 4.951 0 0 1 1.127-.438 4.88 4.88 0 0 1 1.228-.158c.83 0 1.444.184 1.844.552.4.368.6.958.6 1.771V47h-.781zm-2.38-.743c.656 0 1.17-.18 1.545-.54.375-.359.562-.863.562-1.51v-.628l-1.054.044c-.838.03-1.442.16-1.812.39-.37.231-.555.59-.555 1.076 0 .381.115.671.346.87.23.199.553.298.968.298zm6.322-6.214v4.412l-.045 1.155-.019.362 3.765-5.929h1.314V47h-.984v-4.253l.019-.838.031-.825L161.494 47h-1.314v-6.957h.99zm1.987-.92c-.783 0-1.354-.152-1.714-.454-.36-.303-.56-.801-.603-1.495h.99c.038.44.153.747.346.92.193.174.528.26 1.006.26.436 0 .759-.093.968-.279.21-.186.338-.486.384-.901h.997c-.051.668-.265 1.16-.641 1.476-.377.315-.955.473-1.733.473zm6.316.92v2.914h3.897v-2.914h1.054V47h-1.054v-3.136h-3.897V47h-1.054v-6.957h1.054zM180.937 47l-.21-.99h-.05c-.348.436-.694.73-1.039.885-.344.155-.775.232-1.291.232-.69 0-1.23-.178-1.622-.533-.392-.356-.587-.861-.587-1.517 0-1.405 1.123-2.142 3.37-2.21l1.181-.037v-.432c0-.546-.117-.949-.352-1.21-.235-.26-.61-.39-1.127-.39-.58 0-1.236.178-1.968.534l-.324-.807a4.951 4.951 0 0 1 1.127-.438 4.88 4.88 0 0 1 1.228-.158c.83 0 1.445.184 1.844.552.4.368.6.958.6 1.771V47h-.78zm-2.38-.743c.655 0 1.17-.18 1.545-.54.374-.359.562-.863.562-1.51v-.628l-1.054.044c-.838.03-1.442.16-1.812.39-.37.231-.556.59-.556 1.076 0 .381.116.671.346.87.23.199.553.298.968.298z" fill="#FFF" /></g></svg>
          </a>
          <nav className={css.nav}>
            <Menu
              className={css['nav-list']}
              itemClassName={css['nav-list__item']}
              linkClassName={css['nav-list__link']}
              bind="menu"
            />
            <a
              href="tel:+380673258146"
              className={classNames(css.header__button, css.button)}
              bind="cta"
            >
              <Text bind="phone" />
            </a>
          </nav>
          <button
            type="button"
            className={classNames(css['nav-button'])}
            onClick={this.toggleOpened}
            title="Switch menu"
          >
            <span className={css['nav-button__line']} aria-hidden="true" />
            <span className={css['nav-button__line']} aria-hidden="true" />
            <span className={css['nav-button__line']} aria-hidden="true" />
          </button>
        </div>
      </header>
    )
  }
}

Block.components = _.pick(['Text', 'Menu', 'Button', 'Logo'])($editor.components)

Block.options = {
  invert: true,
}

Block.defaultContent = {
  title: 'CompanyLogo',
  subtitle: 'CompanySlogan',
  theme: 'dark',
  logo: {
    text: {
      value: 'Your logo',
    },
    image: {
      resourceRef: null,
      width: null,
      height: null,
      proportion: 1,
    },
    tagName: 'a',
  },
  phone: '+38-067-325-81-46',
  menu: [
    {
      id: 'b72a2300-1a8e-48b5-810b-616deb2bf4b1',
      metadata: {
        displayName: 'о нас',
        clickAction: {
          action: 'page',
          target: '_self',
          actions: {
            page: '',
            link: '',
            block: '',
          },
        },
      },
    },
    {
      id: 'cf9a2600-1bb2-4579-9c46-a176263caead',
      metadata: {
        displayName: 'портфолио',
        clickAction: {
          action: 'page',
          target: '_self',
          actions: {
            page: '',
            link: '',
            block: '',
          },
        },
      },
    },
    {
      id: '7835f494-84ad-4de1-aadd-321064670976',
      metadata: {
        displayName: 'преимущества',
        clickAction: {
          action: 'page',
          target: '_self',
          actions: {
            page: '',
            link: '',
            block: '',
          },
        },
      },
    },
    {
      id: '369bb292-644f-4070-b188-2b0066973fa8',
      metadata: {
        displayName: 'ОТЗЫВЫ КЛИЕНТОВ',
        clickAction: {
          action: 'page',
          target: '_self',
          actions: {
            page: '',
            link: '',
            block: '',
          },
        },
      },
    },
    {
      id: '1c4e7978-19e0-4774-ad33-bb45807b7356',
      metadata: {
        displayName: 'контакты',
        clickAction: {
          action: 'page',
          target: '_self',
          actions: {
            page: '',
            link: '',
            block: '',
          },
        },
      },
    },
  ],
  cta: {
    actionConfig: {
      action: 'link',
      actions: {
        link: {
          type: '',
          innerPage: '',
          url: '',
        },
      },
    },
    textValue: 'Request a quote',
  },
}

export default Block
